<div>
  <h2 id="page-heading" data-cy="SummarizePlanHeading">
    <span>Báo cáo đánh giá tổng hợp theo ngành</span>
  </h2>
  <div class="col-container">
    <div class="col-container">
      <div class="col col-container-child mx-2">
        <label for="field_timeStart">Thời gian bắt đầu</label>
        <p-calendar appendTo="body" [(ngModel)]="reportDto.timeStart" dateFormat="dd/mm/yy" [showTime]="false" [hourFormat]="'24'" />
      </div>
      <div class="col col-container-child mx-2">
        <label for="field_timeEnd">Thời gian kết thúc</label>
        <p-calendar appendTo="body" [(ngModel)]="reportDto.timeEnd" dateFormat="dd/mm/yy" [showTime]="false" [hourFormat]="'24'" />
      </div>
      <div class="col col-container-child mx-2">
        <label for="field_selectedBranches">Bộ phận được kiểm tra</label>
        <p-multiSelect
          [maxSelectedLabels]="1"
          [options]="listBranch"
          optionLabel="name"
          optionValue="name"
          placeholder="Không đánh giá"
          [(ngModel)]="reportDto.subjectOfAssetmentPlan"
          [showClear]="true"
          id="field_selectedBranches"
          display="chip"
          [appendTo]="'body'"
          styleClass="w-full"
        />
      </div>
      <div class="col col-container-child mx-2">
        <label for="field_selectedReportType">Loại BBKT</label>
        <p-multiSelect
          [maxSelectedLabels]="1"
          [options]="listReportType"
          optionLabel="name"
          optionValue="name"
          placeholder="Không đánh giá"
          [(ngModel)]="reportDto.reportType"
          [showClear]="true"
          id="field_selectedReportType"
          display="chip"
          [appendTo]="'body'"
          styleClass="w-full"
        />
      </div>
    </div>
  </div>

  <div class="d-flex justify-content-end">
    <button pButton type="button" label="Tìm kiếm" icon="pi pi-search" class="p-button-infor" (click)="loadData()"></button>
    <button pButton type="button" label="Xuất Excel" icon="pi pi-file-excel" class="p-button-success" (click)="exportExcel()"></button>
  </div>

  <div class="table-reposive">
    <p-table
      [value]="data"
      [paginator]="true"
      [rows]="pageSize"
      [totalRecords]="totalRecords"
      [lazy]="true"
      [loading]="loading"
      (onLazyLoad)="onPage($event)"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Hiển thị {first} đến {last} trong tổng số {totalRecords} mục"
      [tableStyle]="{ 'min-width': '50rem' }"
    >
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="timeStart">Thời gian kế hoạch KT<p-sortIcon field="timeStart"></p-sortIcon></th>
          <th pSortableColumn="subjectOfAssetmentPlan">Ngành <p-sortIcon field="subjectOfAssetmentPlan"></p-sortIcon></th>
          <th pSortableColumn="reportType">Tổng BBKT phát hành <p-sortIcon field="reportType"></p-sortIcon></th>
          <th pSortableColumn="reportType">Loại BB Kiểm tra <p-sortIcon field="reportType"></p-sortIcon></th>
          <th pSortableColumn="sumOfAudit">Tổng số đợt kiểm tra <p-sortIcon field="sumOfAudit"></p-sortIcon></th>
          <th pSortableColumn="sumOfCreateReport">Tổng số lần lập biên bản <p-sortIcon field="sumOfCreateReport"></p-sortIcon></th>
          <th>Tổng điểm</th>
          <th>Điểm trung bình</th>
          <th pSortableColumn="sumOfNc">Tổng NC <p-sortIcon field="sumOfNc"></p-sortIcon></th>
          <th pSortableColumn="sumOfLy">Tổng LY <p-sortIcon field="sumOfLy"></p-sortIcon></th>
          <th pSortableColumn="sumOfLy">Tổng PASS <p-sortIcon field="sumOfLy"></p-sortIcon></th>
          <th pSortableColumn="sumOfPass">Tổng đạt <p-sortIcon field="sumOfPass"></p-sortIcon></th>
          <th pSortableColumn="sumOfFail">Tổng không đạt <p-sortIcon field="sumOfFail"></p-sortIcon></th>
          <th pSortableColumn="sumOfUncheck">Tổng số lỗi đã khắc phục <p-sortIcon field="sumOfUncheck"></p-sortIcon></th>
          <th pSortableColumn="sumOfUncheck">Tổng số lỗi chưa khắc phục <p-sortIcon field="sumOfUncheck"></p-sortIcon></th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-row>
        <tr>
          <td>{{ row.timeStart }}</td>
          <td>{{ row.subjectOfAssetmentPlan }}</td>
          <td>{{ row.sumOfReport }}</td>
          <td>{{ row.reportType }}</td>
          <td>{{ row.sumOfAudit }}</td>
          <td>{{ row.sumOfCreateReport }}</td>
          <td>{{ getTotalPoint(row) }}</td>
          <td>{{ getTotalPointAvg(row) | noZeroDecimal }}</td>
          <td>{{ row.sumOfNc }}</td>
          <td>{{ row.sumOfLy }}</td>
          <td>{{ row.sumOfPass }}</td>
          <td>{{ row.sumOfDat }}</td>
          <td>{{ row.sumOfFail }}</td>
          <td>{{ row.sumOfCheck }}</td>
          <td>{{ row.sumOfUncheck }}</td>
        </tr>
      </ng-template>
      <ng-template pTemplate="empty">
        <tr>
          <td colspan="19">No records found</td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
